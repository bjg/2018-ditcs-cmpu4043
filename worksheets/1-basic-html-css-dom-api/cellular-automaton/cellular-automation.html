<!DOCTYPE html>
<html>
    <head>
        <title>Cellular Automation</title>
    </head>
    <body>
        <script>
            const num_cols = 101;
            const num_rows = 50;
            const cell_width = 8;
            const cell_height = 8;
            const active = "active";
            const inactive = "inactive";
    

            function generate_cell(state) {
                cell = document.createElement('div');
                cell.style.width = cell_width.toString()+"px";
                cell.style.height = cell_height.toString()+"px";
                cell.style.border = "1px solid black";
                cell.style.display = "inline-block";
                cell.style.margin = "0 1px 0 1px";
                if(state === active) {
                    cell.style.backgroundColor = 'green';
                }
                else {
                    cell.style.backgroundColor = 'white';
                }
    
                return cell;
            }


            function get_random_state() {
                if(Math.random() < 0.9) {
                    return active;
                }
                else return inactive;
            }


            function row_template() {
                row = document.createElement('div');
                row.width = (num_cols * cell_width).toString()+"px";
                row.height = cell_height.toString()+"px";
                return row;
            }


            function init_row() {
                row = row_template();
                for(i=0; i<num_cols; i++) {
                    cell = generate_cell(get_random_state());
                    row.appendChild(cell);
                }
                return row;
            }


            function get_new_cell_state(left_cell, middle_cell, right_cell) {
                if(
                    (left_cell.style.backgroundColor === 'green' && middle_cell.style.backgroundColor === 'white' && right_cell.style.backgroundColor === 'green')
                    ||
                    (left_cell.style.backgroundColor === 'green' && middle_cell.style.backgroundColor === 'white' && right_cell.style.backgroundColor === 'white')
                    ||
                    (left_cell.style.backgroundColor === 'white' && middle_cell.style.backgroundColor === 'green' && right_cell.style.backgroundColor === 'green') 
                    ||
                    (left_cell.style.backgroundColor === 'white' && middle_cell.style.backgroundColor === 'green' && right_cell.style.backgroundColor === 'white')
                  ) 
                {
                    return active;
                }
                else 
                {
                    return inactive;
                }
            }


            function get_next_row(prev_row) {
                prev_cells = prev_row.querySelectorAll('div');
                new_row = row_template();
                for(index=0; index<num_cols; index++) {
                    direct_ancestor_index = index;
                    if(direct_ancestor_index === 0) {
                        direct_ancestor_left_index = num_cols-1;
                        direct_ancestor_right_index = 1;
                    }
                    else if(direct_ancestor_index === num_cols-1) {
                        direct_ancestor_right_index = 0;
                        direct_ancestor_left_index = num_cols-2;
                    }
                    else {
                        direct_ancestor_left_index = index-1;
                        direct_ancestor_right_index = index+1;
                    }
                    cell_state = get_new_cell_state(prev_cells[direct_ancestor_left_index], prev_cells[direct_ancestor_index], prev_cells[direct_ancestor_right_index]);
                    cell = generate_cell(cell_state);
                    new_row.appendChild(cell);
                }

                return new_row;
            }


            //use recursion to generate final grid
            function generate_grid(p_row, r_count) {
                if(r_count === num_rows) {
                    return;
                }
                else {
                    n_row = get_next_row(p_row);
                    document.body.appendChild(n_row);
                    generate_grid(n_row, r_count+1);
                }
            }

            generate_grid(init_row(), 1);
        </script>
    </body>
</html>